"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[241],{3786(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"authentication/sdk-oauth","title":"SDK OAuth Implementation","description":"Complete example of implementing OAuth with the SDK.","source":"@site/docs/authentication/sdk-oauth.md","sourceDirName":"authentication","slug":"/authentication/sdk-oauth","permalink":"/Instagram-graph-api-sdk/authentication/sdk-oauth","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Access Tokens","permalink":"/Instagram-graph-api-sdk/authentication/access-tokens"},"next":{"title":"User Profile","permalink":"/Instagram-graph-api-sdk/guides/user-profile"}}');var s=t(4848),r=t(8453);const i={sidebar_position:3},o="SDK OAuth Implementation",c={},l=[{value:"Full Implementation",id:"full-implementation",level:2},{value:"Route: Initiate Login",id:"route-initiate-login",level:3},{value:"Route: Handle Callback",id:"route-handle-callback",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Express.js Example",id:"expressjs-example",level:2},{value:"Scopes Reference",id:"scopes-reference",level:2}];function p(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"sdk-oauth-implementation",children:"SDK OAuth Implementation"})}),"\n",(0,s.jsx)(n.p,{children:"Complete example of implementing OAuth with the SDK."}),"\n",(0,s.jsx)(n.h2,{id:"full-implementation",children:"Full Implementation"}),"\n",(0,s.jsx)(n.p,{children:"Here's a complete Next.js example:"}),"\n",(0,s.jsx)(n.h3,{id:"route-initiate-login",children:"Route: Initiate Login"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// app/api/instagram/login/route.ts\nimport { InstagramOAuth } from 'instagram-graph-api-sdk';\nimport { cookies } from 'next/headers';\nimport { redirect } from 'next/navigation';\nimport crypto from 'crypto';\n\nexport async function GET() {\n  // Generate CSRF state\n  const state = crypto.randomUUID();\n  \n  // Store state in cookie for verification\n  cookies().set('instagram_oauth_state', state, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    maxAge: 600, // 10 minutes\n  });\n\n  // Build authorization URL\n  const authUrl = InstagramOAuth.buildAuthorizationUrl({\n    clientId: process.env.INSTAGRAM_APP_ID!,\n    redirectUri: `${process.env.NEXT_PUBLIC_URL}/api/instagram/callback`,\n    scopes: InstagramOAuth.getDefaultScopes(),\n    state,\n  });\n\n  redirect(authUrl);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"route-handle-callback",children:"Route: Handle Callback"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// app/api/instagram/callback/route.ts\nimport { InstagramOAuth, InstagramClient } from 'instagram-graph-api-sdk';\nimport { cookies } from 'next/headers';\nimport { redirect } from 'next/navigation';\n\nexport async function GET(request: Request) {\n  const url = new URL(request.url);\n  \n  // Parse callback parameters\n  const { code, state, error } = InstagramOAuth.parseCallback(url.toString());\n\n  // Handle denial\n  if (error) {\n    redirect('/login?error=access_denied');\n  }\n\n  // Verify CSRF state\n  const savedState = cookies().get('instagram_oauth_state')?.value;\n  if (state !== savedState) {\n    redirect('/login?error=csrf_failed');\n  }\n\n  try {\n    // Exchange code for tokens\n    const tokens = await InstagramOAuth.exchangeCodeForToken({\n      clientId: process.env.INSTAGRAM_APP_ID!,\n      clientSecret: process.env.INSTAGRAM_APP_SECRET!,\n      redirectUri: `${process.env.NEXT_PUBLIC_URL}/api/instagram/callback`,\n      code: code!,\n    });\n\n    // Get user profile\n    const client = new InstagramClient({\n      accessToken: tokens.access_token,\n    });\n    const profile = await client.users.getProfile({\n      fields: ['id', 'username', 'profile_picture_url'],\n    });\n\n    // Save to database\n    await saveUser({\n      instagramId: tokens.user_id,\n      username: profile.username,\n      accessToken: tokens.access_token,\n      expiresAt: new Date(Date.now() + tokens.expires_in * 1000),\n    });\n\n    // Clean up state cookie\n    cookies().delete('instagram_oauth_state');\n\n    redirect('/dashboard?connected=true');\n  } catch (err) {\n    console.error('OAuth error:', err);\n    redirect('/login?error=token_exchange_failed');\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# .env.local\nINSTAGRAM_APP_ID=your_app_id\nINSTAGRAM_APP_SECRET=your_app_secret\nNEXT_PUBLIC_URL=http://localhost:3000\n"})}),"\n",(0,s.jsx)(n.h2,{id:"expressjs-example",children:"Express.js Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import express from 'express';\nimport { InstagramOAuth, InstagramClient } from 'instagram-graph-api-sdk';\nimport crypto from 'crypto';\n\nconst app = express();\n\n// Store states (use Redis in production)\nconst states = new Map<string, number>();\n\napp.get('/auth/instagram', (req, res) => {\n  const state = crypto.randomUUID();\n  states.set(state, Date.now());\n\n  const authUrl = InstagramOAuth.buildAuthorizationUrl({\n    clientId: process.env.INSTAGRAM_APP_ID!,\n    redirectUri: `${process.env.APP_URL}/auth/instagram/callback`,\n    scopes: InstagramOAuth.getDefaultScopes(),\n    state,\n  });\n\n  res.redirect(authUrl);\n});\n\napp.get('/auth/instagram/callback', async (req, res) => {\n  const { code, state, error } = InstagramOAuth.parseCallback(\n    `${req.protocol}://${req.get('host')}${req.originalUrl}`\n  );\n\n  if (error || !states.has(state!)) {\n    return res.redirect('/login?error=auth_failed');\n  }\n\n  states.delete(state!);\n\n  const tokens = await InstagramOAuth.exchangeCodeForToken({\n    clientId: process.env.INSTAGRAM_APP_ID!,\n    clientSecret: process.env.INSTAGRAM_APP_SECRET!,\n    redirectUri: `${process.env.APP_URL}/auth/instagram/callback`,\n    code: code!,\n  });\n\n  // Save tokens and redirect\n  req.session.accessToken = tokens.access_token;\n  res.redirect('/dashboard');\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"scopes-reference",children:"Scopes Reference"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Default scopes (most common use case)\nInstagramOAuth.getDefaultScopes()\n// Returns: ['instagram_business_basic', 'instagram_business_manage_messages', \n//           'instagram_business_manage_comments', 'instagram_business_content_publish']\n\n// All available scopes\nInstagramOAuth.getAllScopes()\n// Also includes: 'instagram_business_manage_insights'\n\n// Custom scopes\nInstagramOAuth.buildAuthorizationUrl({\n  // ...\n  scopes: ['instagram_business_basic'], // Only basic read access\n});\n"})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},8453(e,n,t){t.d(n,{R:()=>i,x:()=>o});var a=t(6540);const s={},r=a.createContext(s);function i(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);