"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[129],{9714(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"guides/webhooks","title":"Webhooks","description":"Receive real-time notifications for Instagram events.","source":"@site/docs/guides/webhooks.md","sourceDirName":"guides","slug":"/guides/webhooks","permalink":"/Instagram-graph-api-sdk/guides/webhooks","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"docsSidebar","previous":{"title":"Insights & Analytics","permalink":"/Instagram-graph-api-sdk/guides/insights"},"next":{"title":"Overview","permalink":"/Instagram-graph-api-sdk/api-reference/"}}');var t=s(4848),r=s(8453);const a={sidebar_position:6},o="Webhooks",c={},d=[{value:"What are Webhooks?",id:"what-are-webhooks",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Setting Up Webhooks",id:"setting-up-webhooks",level:2},{value:"Step 1: Create Your Endpoint",id:"step-1-create-your-endpoint",level:3},{value:"Verification (GET)",id:"verification-get",level:4},{value:"Event Notifications (POST)",id:"event-notifications-post",level:4},{value:"Step 2: Configure in App Dashboard",id:"step-2-configure-in-app-dashboard",level:3},{value:"Step 3: Subscribe to Events",id:"step-3-subscribe-to-events",level:3},{value:"Step 4: Using the SDK (Easier!)",id:"step-4-using-the-sdk-easier",level:3},{value:"Verify Signature",id:"verify-signature",level:4},{value:"Parse Payload",id:"parse-payload",level:4},{value:"Manage Subscriptions",id:"manage-subscriptions",level:4},{value:"Available Webhook Events",id:"available-webhook-events",level:2},{value:"Payload Examples",id:"payload-examples",level:2},{value:"New Message",id:"new-message",level:3},{value:"New Comment",id:"new-comment",level:3},{value:"Message Reaction",id:"message-reaction",level:3},{value:"Security Best Practices",id:"security-best-practices",level:2},{value:"Testing",id:"testing",level:2}];function l(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"webhooks",children:"Webhooks"})}),"\n",(0,t.jsx)(n.p,{children:"Receive real-time notifications for Instagram events."}),"\n",(0,t.jsx)(n.h2,{id:"what-are-webhooks",children:"What are Webhooks?"}),"\n",(0,t.jsx)(n.p,{children:"Instead of polling the API, Meta sends HTTPS requests to your server when events occur:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"New comments on your posts"}),"\n",(0,t.jsx)(n.li,{children:"Direct messages received"}),"\n",(0,t.jsx)(n.li,{children:"@mentions"}),"\n",(0,t.jsx)(n.li,{children:"Message reactions"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"HTTPS endpoint"})," with valid SSL certificate"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"App must be Live"})," (not in Development mode)"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 Advanced Access for ",(0,t.jsx)(n.code,{children:"comments"})," field"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"setting-up-webhooks",children:"Setting Up Webhooks"}),"\n",(0,t.jsx)(n.h3,{id:"step-1-create-your-endpoint",children:"Step 1: Create Your Endpoint"}),"\n",(0,t.jsx)(n.p,{children:"Your endpoint must handle two types of requests:"}),"\n",(0,t.jsx)(n.h4,{id:"verification-get",children:"Verification (GET)"}),"\n",(0,t.jsx)(n.p,{children:"When you configure webhooks, Meta verifies your endpoint:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Example: Next.js API route\nimport { NextRequest, NextResponse } from 'next/server';\n\nexport async function GET(request: NextRequest) {\n  const searchParams = request.nextUrl.searchParams;\n  \n  const mode = searchParams.get('hub.mode');\n  const token = searchParams.get('hub.verify_token');\n  const challenge = searchParams.get('hub.challenge');\n\n  // Verify the token matches your secret\n  if (mode === 'subscribe' && token === process.env.WEBHOOK_VERIFY_TOKEN) {\n    console.log('Webhook verified!');\n    return new NextResponse(challenge, { status: 200 });\n  }\n  \n  return new NextResponse('Forbidden', { status: 403 });\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"event-notifications-post",children:"Event Notifications (POST)"}),"\n",(0,t.jsx)(n.p,{children:"Handle incoming events:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { NextRequest, NextResponse } from 'next/server';\nimport crypto from 'crypto';\n\nexport async function POST(request: NextRequest) {\n  const body = await request.text();\n  \n  // Verify signature (IMPORTANT!)\n  const signature = request.headers.get('X-Hub-Signature-256');\n  const expectedSignature = 'sha256=' + crypto\n    .createHmac('sha256', process.env.INSTAGRAM_APP_SECRET!)\n    .update(body)\n    .digest('hex');\n    \n  if (signature !== expectedSignature) {\n    return new NextResponse('Invalid signature', { status: 401 });\n  }\n\n  const data = JSON.parse(body);\n  \n  // Process the event\n  for (const entry of data.entry) {\n    // Handle messages\n    if (entry.messaging) {\n      for (const event of entry.messaging) {\n        if (event.message) {\n          console.log('New message:', event.message.text);\n        }\n      }\n    }\n    \n    // Handle comments\n    if (entry.changes) {\n      for (const change of entry.changes) {\n        if (change.field === 'comments') {\n          console.log('New comment:', change.value.text);\n        }\n      }\n    }\n  }\n\n  return new NextResponse('OK', { status: 200 });\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-2-configure-in-app-dashboard",children:"Step 2: Configure in App Dashboard"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Go to ",(0,t.jsx)(n.strong,{children:"App Dashboard"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Webhooks"})]}),"\n",(0,t.jsxs)(n.li,{children:["Select ",(0,t.jsx)(n.strong,{children:"Instagram"})]}),"\n",(0,t.jsx)(n.li,{children:"Enter your webhook URL"}),"\n",(0,t.jsx)(n.li,{children:"Enter your verify token"}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Verify and Save"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"step-3-subscribe-to-events",children:"Step 3: Subscribe to Events"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -X POST \\\n  "https://graph.instagram.com/v22.0/{account-id}/subscribed_apps" \\\n  -F "subscribed_fields=messages,comments" \\\n  -F "access_token={access-token}"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"step-4-using-the-sdk-easier",children:"Step 4: Using the SDK (Easier!)"}),"\n",(0,t.jsx)(n.p,{children:"The SDK provides built-in utilities for verification and parsing."}),"\n",(0,t.jsx)(n.h4,{id:"verify-signature",children:"Verify Signature"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { InstagramWebhooks } from 'instagram-graph-api-sdk';\n\n// In your POST handler:\nconst isValid = InstagramWebhooks.verifySignature(\n  rawBody, \n  signatureHeader, \n  process.env.INSTAGRAM_APP_SECRET\n);\n\nif (!isValid) return new NextResponse('Unauthorized', { status: 401 });\n"})}),"\n",(0,t.jsx)(n.h4,{id:"parse-payload",children:"Parse Payload"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"try {\n  const payload = InstagramWebhooks.parsePayload(JSON.parse(rawBody));\n  \n  if (payload.entry[0].changes) {\n    // Handle changes (comments, etc.)\n  }\n} catch (e) {\n  console.error('Invalid payload');\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"manage-subscriptions",children:"Manage Subscriptions"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Subscribe to events\nawait client.webhooks.subscribe(['messages', 'comments']);\n\n// List subscriptions\nconst subs = await client.webhooks.getSubscribedFields();\n\n// Unsubscribe\nawait client.webhooks.unsubscribe();\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"available-webhook-events",children:"Available Webhook Events"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Permission"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"messages"})}),(0,t.jsx)(n.td,{children:"Direct messages"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"instagram_business_manage_messages"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"comments"})}),(0,t.jsx)(n.td,{children:"Post comments"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"instagram_business_manage_comments"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"live_comments"})}),(0,t.jsx)(n.td,{children:"Live video comments"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"instagram_business_manage_comments"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"message_reactions"})}),(0,t.jsx)(n.td,{children:"Reactions to messages"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"instagram_business_manage_messages"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"messaging_seen"})}),(0,t.jsx)(n.td,{children:"Read receipts"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"instagram_business_manage_messages"})})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"payload-examples",children:"Payload Examples"}),"\n",(0,t.jsx)(n.h3,{id:"new-message",children:"New Message"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "object": "instagram",\n  "entry": [{\n    "id": "123456789",\n    "time": 1234567890,\n    "messaging": [{\n      "sender": { "id": "sender_igsid" },\n      "recipient": { "id": "your_account_id" },\n      "timestamp": 1234567890,\n      "message": {\n        "mid": "message_id",\n        "text": "Hello!"\n      }\n    }]\n  }]\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"new-comment",children:"New Comment"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "object": "instagram",\n  "entry": [{\n    "id": "123456789",\n    "time": 1234567890,\n    "changes": [{\n      "field": "comments",\n      "value": {\n        "id": "comment_id",\n        "text": "Nice post!",\n        "from": {\n          "id": "user_igsid",\n          "username": "commenter"\n        },\n        "media": {\n          "id": "media_id"\n        }\n      }\n    }]\n  }]\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"message-reaction",children:"Message Reaction"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "messaging": [{\n    "sender": { "id": "sender_igsid" },\n    "reaction": {\n      "mid": "message_id",\n      "action": "react",\n      "reaction": "love",\n      "emoji": "\u2764\ufe0f"\n    }\n  }]\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"security-best-practices",children:"Security Best Practices"}),"\n",(0,t.jsx)(n.admonition,{title:"Always Verify Signatures",type:"danger",children:(0,t.jsxs)(n.p,{children:["Never process webhook payloads without verifying the ",(0,t.jsx)(n.code,{children:"X-Hub-Signature-256"})," header. This prevents attackers from sending fake events."]})}),"\n",(0,t.jsx)(n.admonition,{title:"Respond Quickly",type:"tip",children:(0,t.jsxs)(n.p,{children:["Return ",(0,t.jsx)(n.code,{children:"200 OK"})," immediately, then process events asynchronously. Meta will retry if your endpoint is slow."]})}),"\n",(0,t.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Use the ",(0,t.jsx)(n.strong,{children:"Test"})," button in App Dashboard \u2192 Webhooks"]}),"\n",(0,t.jsx)(n.li,{children:"Send a DM to your connected Instagram account"}),"\n",(0,t.jsx)(n.li,{children:"Check your server logs for the payload"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453(e,n,s){s.d(n,{R:()=>a,x:()=>o});var i=s(6540);const t={},r=i.createContext(t);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);